<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Project Reports</title>


    <script type="text/javascript">
        window.onload = function() {
            var chart = new CanvasJS.Chart("chartContainer", {
                title: {
                    text: "Progress of Project - A"
                },
                legend: {
                    maxWidth: 350,
                    itemWidth: 120
                },
                data: [{
                    type: "pie",
                    showInLegend: true,
                    legendText: "{indexLabel}",
                    dataPoints: [{
                        y: 4181563,
                        indexLabel: "Task 1"
                    }, {
                        y: 2175498,
                        indexLabel: "Task 2"
                    }, {
                        y: 3125844,
                        indexLabel: "Task 3"
                    }, {
                        y: 1176121,
                        indexLabel: "Task 4"
                    }, ]
                }]
            });
            chart.render();
        }
    </script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./main.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <div class="wrapper">
        <!-- Sidebar  -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3>Project Management System</h3>
            </div>

            <ul class="list-unstyled components">
                <li >
                  <a href="../create Project/project.html"><i class="fas fa-home" aria-hidden="true"></i>&nbsp;&nbsp;Home</a>
                </li>

                <li class="active">
                  <a href="../boards/dashboard.html"><i class="fas fa-cube" aria-hidden="true"></i>&nbsp;&nbsp;Kanban</a>
                </li>

                <li>
                    <a href="../issues/new.html"> <i class="fas fa-file" aria-hidden="true"></i>&nbsp; New Task / Issue</a>
                </li>

                <li>
                    <a href="../boards/create_new_db.html"> <i class="fas fa-clipboard" aria-hidden="true"></i>&nbsp; New Board</a>
                </li>

                <li>
                    <a href="../reports/report.html"><i class="fas fa-chart-pie" aria-hidden="true"></i>
                        &nbsp;
                        Report</a>
                </li>

                <li>

                    <a href="../settings/settings.html"> <i class="fas fa-cogs" aria-hidden="true"></i> &nbsp;&nbsp; Settings</a>
                </li>

                <li>

                    <a href="../users/userDetails.html"> <i class="fas fa-user-circle" aria-hidden="true"></i>&nbsp;&nbsp; My Profile</a>
                </li>

                <li>

                    <a href="../login/login.html">
                        <i class="fas fa-sign-out-alt" aria-hidden="true"></i> &nbsp;&nbsp; Logout
                    </a>
                </li>
            </ul>
            
        </nav>

        <!-- Page Content  -->
        <div id="content">

            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">

                    <button type="button" id="sidebarCollapse" class="btn btn-info btn-dark ">
                        <i class="fas fa-align-left"></i>
                        <span>Menu</span>
                    </button>
                </div>
            </nav>
            <div class="chart">
              <a class="pie-chart" href="../reports/piechart.html">
                <button class="pie-chart" background-color: #343a40;> Pie Chart</button>
              </a>
            </div>
            <div class="chartMenu">
              <p>Gnatt Chart view of tasks</p>
            </div>
            <div class="chartCard">
              <div class="chartBox">
                <canvas id="myChart"></canvas>
                <input type="month" onchange="chartFilter(this)" />
        
                <br><br>
                <hr>
                <br>
                <input type="text" id="nameTask" list="tasks" />
                <datalist id="tasks">
                </datalist>
        
                <input type="date" id="startDateTask" />
                <input type="date" id="endDateTask" />
                <input type="text" id="teamMemberTask" list="names" />
                <datalist id="names">
                </datalist>
        
                <select id="statusTask">
                  <option value="0">Delayed</option>
                  <option value="1">Pending</option>
                  <option value="2">Complete</option>
                </select>
                <button onclick="addTask()">Add Task</button>
        
                <br><br>
                <hr>
                <br>
        
                <select id="minTask" onchange="showTask()">
                  <option selected value="0">Task 1</option>
                  <option value="1">Task 2</option>
                  <option value="2">Task 3</option>
                  <option value="3">Task 4</option>
                </select>
        
                <select id="maxTask" onchange="showTask()">
                  <option value="5">Task 6</option>
                  <option value="6">Task 7</option>
                  <option value="7">Task 8</option>
                  <option selected value="8">Task 9</option>
                </select>
        
              </div>
            </div>
            <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
        
            <script>
            const colours = ['rgba(255, 26, 104, 1)', 'rgba(255, 159, 64, 1)', 'rgba(75, 192, 192, 1)'];
        
            // setup 
            const data = {
              //labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
              datasets: [{
                label: 'Weekly Sales',
                data: [
                  {x: ['2022-10-03', '2022-11-06'], y: 'Task 1', name: 'James', status: 2},
                  {x: ['2022-11-06', '2022-11-12'], y: 'Task 2', name: 'Luna', status: 2},
                  {x: ['2022-11-09', '2022-11-31'], y: 'Task 3', name: 'David', status: 2},
                  {x: ['2022-11-12', '2022-11-31'], y: 'Task 4', name: 'Lily', status: 1},
                  {x: ['2022-11-15', '2022-12-24'], y: 'Task 5', name: 'Santiago', status: 0},
                  {x: ['2022-11-18', '2022-12-30'], y: 'Task 6', name: 'James', status: 1},
                  {x: ['2022-11-12', '2022-12-21'], y: 'Task 7', name: 'Lily', status: 1},
                  {x: ['2022-11-15', '2022-12-24'], y: 'Task 8', name: 'Santiago', status: 0},
                  {x: ['2022-11-18', '2022-12-30'], y: 'Task 9', name: 'James', status: 1},
                  {x: ['2022-11-18', '2022-12-30'], y: 'Task 1', name: 'James', status: 1},
                ],
                backgroundColor: (ctx) => {
                  return colours[ctx.raw.status]
                },        
                borderSkipped: false,
                borderRadius: 10,
                barPercentage: 0.5
              }]
            };
        
            const labelsArray = data.datasets[0].data.map((dataPoint, index) => {
              return dataPoint.y;
            })
            const labelsArrayFilter = [...new Set(labelsArray)];
        
            // todayLine plugin block
            const todayLine = {
              id: 'todayLine',
              afterDatasetsDraw(chart, args, pluginOptions) {
                const { ctx, data, chartArea: { top, bottom, left, right }, scales: { x, y } } = chart;
        
                ctx.save();
        
                if(x.getPixelForValue(new Date()) >= left && x.getPixelForValue(new Date()) <= right) {
                  ctx.beginPath();
                  ctx.lineWidth = 3;
                  ctx.strokeStyle = 'rgba(102, 102, 102, 1)';
                  ctx.setLineDash([6, 6]);
                  ctx.moveTo(x.getPixelForValue(new Date()), top);
                  ctx.lineTo(x.getPixelForValue(new Date()), bottom);
                  ctx.stroke();
                  ctx.restore();
        
                  ctx.setLineDash([]);
        
                  ctx.beginPath();
                  ctx.lineWidth = 1; 
                  ctx.strokeStyle = 'rgba(102, 102, 102, 1)';
                  ctx.fillStyle = 'rgba(102, 102, 102, 1)';
                  ctx.moveTo(x.getPixelForValue(new Date()), top + 3);
                  ctx.lineTo(x.getPixelForValue(new Date()) - 6, top - 6);
                  ctx.lineTo(x.getPixelForValue(new Date()) + 6, top - 6);
                  ctx.closePath();
                  ctx.stroke();
                  ctx.fill();
                  ctx.restore();
        
                  ctx.font = 'bold 12px sans-serif';
                  ctx.fillStyle = 'rgba(102, 102, 102, 1)';
                  ctx.textAlign = 'center';
                  ctx.fillText('Today', x.getPixelForValue(new Date()), bottom + 15);
                  ctx.restore();
                }
        
                
        
              }
            }
        
            // status plugin block
            const status = {
              id: 'status',
              afterDatasetsDraw(chart, args, pluginOptions) {
                const { ctx, data, options, chartArea: { top, bottom, left, right }, scales: { x, y } } = chart;
        
                const icons = ['\uf00d', '\uf110', '\uf00c'];
                const angle = Math.PI / 180;
                const paddingRight = options.layout.padding.right;
        
                ctx.save();
                ctx.font = 'bolder 12px FontAwesome';
                ctx.textBaseline = 'middle';
                ctx.textAlign = 'center';
                data.datasets[0].data.forEach((datapoint, index) => {
        
                  if(y.getPixelForValue(index) > top && y.getPixelForValue(index) < bottom) {
                    ctx.beginPath();
                    ctx.fillStyle = colours[datapoint.status];
                    ctx.arc(right + (paddingRight / 2), y.getPixelForValue(index), 12, 0, angle * 360, false);
                    ctx.closePath();
                    ctx.fill();
                    ctx.fillStyle = 'white';
                    ctx.fillText(icons[datapoint.status], right + (paddingRight / 2), y.getPixelForValue(index));
                  }
                });
        
                ctx.font = 'bolder 12px sans-serif';
                ctx.fillStyle = 'black';
                ctx.fillText('Status', right + (paddingRight / 2), top - 15);
                ctx.restore();
        
                // console.log()
        
              }
            }
        
            // assignedTasks plugin block
            const assignedTasks = {
              id: 'assignedTasks',
              afterDatasetsDraw(chart, args, pluginOptions) {
                const { ctx, data, chartArea: { top, bottom, left, right }, scales: { x, y } } = chart;
                ctx.save();
                ctx.font = 'bolder 12px sans-serif';
                ctx.fillStyle = 'black';
                ctx.textBaseline = 'middle';
                ctx.textAlign = 'left';
                data.datasets[0].data.forEach((datapoint, index) => {
                  if(y.getPixelForValue(index) > top && y.getPixelForValue(index) < bottom) {
                    ctx.fillText(datapoint.name, 10, y.getPixelForValue(index));
                  }
                })
                ctx.fillText('Names', 10, top - 15);
                ctx.restore();
              }
            }
        
            // weekend plugin block
            const weekend = {
              id: 'weekend',
              beforeDatasetsDraw(chart, args, pluginOptions) {
                const { ctx, chartArea: { top, bottom, left, right, width, height }, scales: { x, y } } = chart;
        
                ctx.save();
        
                x.ticks.forEach((tick, index) => {
                  const day = new Date(tick.value).getDay();
                  // console.log(day)
                  if(day === 6 || day === 0) {
                    ctx.fillStyle = pluginOptions.weekendColor;
                    ctx.fillRect(x.getPixelForValue(tick.value), 
                      top, 
                      x.getPixelForValue(new Date(tick.value).setHours(24)) - x.getPixelForValue(tick.value), 
                      height);
                  }
                })
        
                
        
              }
            }
        
            // config 
            const config = {
              type: 'bar',
              data,
              options: {
                layout: {
                  padding: {
                    left: 100,
                    right: 100,
                    bottom: 20
                  }
                },
                indexAxis: 'y',
                scales: {
                  x: {
                    position: 'top',
                    type: 'time',
                    time: {
                      //unit: 'day',
                      displayFormats: {
                        day: 'd'
                      }
                    },
                    min: '2022-10-01',
                    max: '2022-12 -31'
                  },
                  y: {
                    min: 3,
                    max: 5,
                    labels: labelsArrayFilter
                  }
                },
                plugins: {
                  weekend: {
                    weekendColor: 'rgba(102, 102, 102, 0.2)'
                  },
                  legend: {
                    display: false
                  },
                  tooltip: {
                    displayColors: false,
                    yAlign: 'bottom',
                    callbacks: {
                      label: (ctx) => {
                        return '';
                      },
                      title: (ctx) => {
                        const startDate = new Date(ctx[0].raw.x[0])
                        const endDate = new Date(ctx[0].raw.x[1])
                        const formattedStartDate = startDate.toLocaleString([], {
                          year: 'numeric',
                          month: 'short',
                          day: 'numeric',
                        });
                        const formattedEndDate = endDate.toLocaleString([], {
                          year: 'numeric',
                          month: 'short',
                          day: 'numeric',
                        });
                        return [ctx[0].raw.name, `Task Deadline: ${formattedStartDate} - ${formattedEndDate}`];
                      }
                    }
                  }
                }
              },
              plugins: [todayLine, assignedTasks, status, weekend]
            };
        
            // render init block
            const myChart = new Chart(
              document.getElementById('myChart'),
              config
            );
        
            function chartFilter(date) {
              const year = date.value.substring(0, 4);
              const month = date.value.substring(5, 7)
              const lastDay = (y, m) => {
                return new Date(y, m, 0).getDate();
              }
        
              const startDate = `${year}-${month}-01`;
              const endDate = `${year}-${month}-${lastDay(year, month)}`;
        
              myChart.config.options.scales.x.min = startDate;
              myChart.config.options.scales.x.max = endDate;
              myChart.update();
            }
        
            function addTask() {
              const nameTask = document.getElementById('nameTask');
              const startDateTask = document.getElementById('startDateTask');
              const endDateTask = document.getElementById('endDateTask');
              const teamMemberTask = document.getElementById('teamMemberTask');
              const statusTask = document.getElementById('statusTask');
              const arrayLength = myChart.data.datasets[0].data.length;
              myChart.data.datasets[0].data[arrayLength] = {x: [startDateTask.value, endDateTask.value], y: nameTask.value, name: teamMemberTask.value, status: parseInt(statusTask.value)};
        
              addNames();
              myChart.update();
            }
        
            function addNames() {
              const names = document.getElementById('names');
              // console.log(names.firstElementChild)
              while(names.firstElementChild) {
                names.removeChild(names.firstElementChild)
              };
        
              const namesArray = myChart.data.datasets[0].data.map((dataPoint) => {
                return dataPoint.name;
              })
        
              const namesArrayFilter = [...new Set(namesArray)]
        
              namesArrayFilter.forEach((memberName) => {
                const option = document.createElement('option');
                option.value = memberName;
                names.appendChild(option);
              })
            };
        
            addNames();
        
            function addTasks() {
              const tasks = document.getElementById('tasks');
              // console.log(names.firstElementChild)
              while(tasks.firstElementChild) {
                tasks.removeChild(tasks.firstElementChild)
              };
        
              labelsArrayFilter.forEach((taskName) => {
                const option = document.createElement('option');
                option.value = taskName;
                tasks.appendChild(option);
              })
            };
        
            addTasks();
        
            function showTask(){
              const yScale = myChart.config.options.scales.y;
              const minTask = document.getElementById('minTask').value;
              const maxTask = document.getElementById('maxTask').value;
              yScale.min = yScale.labels[minTask];
              yScale.max = yScale.labels[maxTask];
              myChart.update();
            }
            </script>
        </div>
</body>

</html>